### TCP 3-Way Handshake와 4-Way Handshake: 개념, 내용 및 예시

---

## **TCP의 개념**

- **TCP(Transmission Control Protocol)**는 신뢰성 있는 데이터 전송을 보장하는 **연결 지향형 프로토콜**입니다.
- 데이터를 송신자와 수신자 간에 정확하고 순서대로 전달하기 위해 **연결 설정**과 **연결 해제** 과정을 거칩니다.
- TCP는 이러한 연결 과정에서 **3-Way Handshake**를 통해 연결을 설정하고, **4-Way Handshake**를 통해 연결을 해제합니다.

---

## **TCP 3-Way Handshake (연결 설정)**

### **1. 개념**
- TCP 3-Way Handshake는 송신자(Client)와 수신자(Server) 간에 **신뢰할 수 있는 연결을 설정하기 위한 과정**입니다.
- 양측이 데이터 전송 준비 상태임을 확인하고, 초기 시퀀스 번호(Sequence Number)를 교환하여 데이터 전송을 시작합니다.

---

### **2. 과정 (Flow)**

| 단계 | 설명                                                                 |
|------|----------------------------------------------------------------------|
| 1️⃣ SYN | 클라이언트가 서버에 연결 요청(SYN 플래그) 패킷 전송.                   |
| 2️⃣ SYN-ACK | 서버가 요청을 수락(SYN 플래그)하고, 응답 패킷에 ACK 플래그를 추가하여 클라이언트로 전송. |
| 3️⃣ ACK | 클라이언트가 서버의 응답을 확인(ACK 플래그)하고, 연결이 설정됨.         |

---

### **3. 예시**

#### 패킷 흐름
1. 클라이언트 → 서버: `SYN` (클라이언트가 연결 요청)
   ```plaintext
   Client: SYN, Seq=100
   ```

2. 서버 → 클라이언트: `SYN-ACK` (요청 수락 및 응답)
   ```plaintext
   Server: SYN, Seq=200, ACK=101
   ```

3. 클라이언트 → 서버: `ACK` (응답 확인)
   ```plaintext
   Client: ACK, Seq=101, ACK=201
   ```

#### 설명:
- 클라이언트는 `SYN` 패킷으로 연결 요청을 시작하며, 시퀀스 번호(Seq)를 포함합니다.
- 서버는 `SYN-ACK` 패킷으로 요청을 수락하고 자신의 시퀀스 번호를 포함하여 응답합니다.
- 클라이언트는 `ACK` 패킷으로 서버의 응답을 확인하며, 연결이 완료됩니다.

---

### **4. 특징**
1. 신뢰성 있는 데이터 전송을 위한 초기 단계.
2. 양측이 데이터 전송 준비 상태임을 확인.
3. 초기 시퀀스 번호를 교환하여 데이터 순서를 보장.

---

## **TCP 4-Way Handshake (연결 해제)**

### **1. 개념**
- TCP 4-Way Handshake는 송신자와 수신자가 데이터를 모두 전송한 후 **연결을 종료하기 위한 과정**입니다.
- 양측이 독립적으로 연결 종료(FIN 플래그)를 요청하며, 각 요청은 상대방의 확인(ACK)을 받습니다.

---

### **2. 과정 (Flow)**

| 단계 | 설명                                                                 |
|------|----------------------------------------------------------------------|
| 1️⃣ FIN | 클라이언트가 서버에게 연결 종료 요청(FIN 플래그).                      |
| 2️⃣ ACK | 서버가 클라이언트의 요청을 확인(ACK 플래그).                          |
| 3️⃣ FIN | 서버가 클라이언트에게 연결 종료 요청(FIN 플래그).                      |
| 4️⃣ ACK | 클라이언트가 서버의 요청을 확인(ACK 플래그).                          |

---

### **3. 예시**

#### 패킷 흐름
1. 클라이언트 → 서버: `FIN` (클라이언트가 연결 종료 요청)
   ```plaintext
   Client: FIN, Seq=300
   ```

2. 서버 → 클라이언트: `ACK` (서버가 종료 요청 확인)
   ```plaintext
   Server: ACK, Seq=400, ACK=301
   ```

3. 서버 → 클라이언트: `FIN` (서버가 연결 종료 요청)
   ```plaintext
   Server: FIN, Seq=400
   ```

4. 클라이언트 → 서버: `ACK` (클라이언트가 종료 요청 확인)
   ```plaintext
   Client: ACK, Seq=301, ACK=401
   ```

#### 설명:
- 클라이언트는 `FIN` 패킷으로 연결 종료를 요청합니다.
- 서버는 `ACK` 패킷으로 이를 확인한 뒤 자신의 작업을 마무리합니다.
- 이후 서버도 `FIN` 패킷으로 연결 종료를 요청하며, 클라이언트는 이를 `ACK`로 확인하여 연결이 완전히 종료됩니다.

---

### **4. 특징**
1. 양방향 통신이 독립적으로 종료됨.
2. 각 측에서 데이터를 모두 전송했음을 보장.
3. 상대방의 종료 요청(FIN)을 반드시 확인(ACK)함.

---

## **TCP 3-Way vs 4-Way Handshake**

| 항목                     | TCP 3-Way Handshake                     | TCP 4-Way Handshake                     |
|--------------------------|-----------------------------------------|-----------------------------------------|
| 목적                     | 신뢰할 수 있는 연결 설정                | 안전한 연결 해제                        |
| 단계                     | SYN → SYN-ACK → ACK                    | FIN → ACK → FIN → ACK                  |
| 데이터 흐름              | 초기 시퀀스 번호 교환                   | 양측 데이터 전송 완료 후 종료           |
| 특징                     | 양측 준비 상태 확인                     | 독립적인 양방향 종료                    |

---

## 요약

1. **TCP 3-Way Handshake**:
   - 송신자와 수신자가 데이터를 신뢰성 있게 주고받기 위해 연결을 설정하는 과정.
   - SYN → SYN-ACK → ACK 단계를 통해 초기 시퀀스 번호를 교환하고 준비 상태를 확인.

2. **TCP 4-Way Handshake**:
   - 송신자와 수신자가 데이터를 모두 주고받은 후 안전하게 연결을 해제하는 과정.
   - FIN → ACK → FIN → ACK 단계를 통해 양측이 독립적으로 연결 종료를 확인.

TCP의 이러한 핸드셰이크 과정은 네트워크에서 신뢰성과 안정성을 제공하며, 데이터 전송 중 오류나 손실 없이 통신할 수 있도록 보장합니다.
